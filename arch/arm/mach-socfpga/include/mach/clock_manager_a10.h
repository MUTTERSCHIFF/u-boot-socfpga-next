/*
 * Copyright (C) 2014 Altera Corporation <www.altera.com>
 *
 * SPDX-License-Identifier:	GPL-2.0+
 */

#ifndef	_SOCFPGA_CLOCK_MANAGER_H_
#define	_SOCFPGA_CLOCK_MANAGER_H_

#ifndef __ASSEMBLY__
int cm_basic_init(const void* blob);
extern unsigned int cm_get_mmc_controller_clk_hz(void);
extern u32 cm_l4_main_clk_hz;
extern u32 cm_l4_sp_clk_hz;
extern u32 cm_l4_mp_clk_hz;
#endif

struct socfpga_clock_manager_main_pll {
	u32	vco0;
	u32	vco1;
	u32	en;
	u32	ens;
	u32	enr;
	u32	bypass;
	u32	bypasss;
	u32	bypassr;
	u32	mpuclk;
	u32	nocclk;
	u32	cntr2clk;
	u32	cntr3clk;
	u32	cntr4clk;
	u32	cntr5clk;
	u32	cntr6clk;
	u32	cntr7clk;
	u32	cntr8clk;
	u32	cntr9clk;
	u32	_pad_0x48_0x5b[5];
	u32	cntr15clk;
	u32	outrst;
	u32	outrststat;
	u32	nocdiv;
};

struct socfpga_clock_manager_per_pll {
	u32	vco0;
	u32	vco1;
	u32	en;
	u32	ens;
	u32	enr;
	u32	bypass;
	u32	bypasss;
	u32	bypassr;
	u32	_pad_0x20_0x27[2];
	u32	cntr2clk;
	u32	cntr3clk;
	u32	cntr4clk;
	u32	cntr5clk;
	u32	cntr6clk;
	u32	cntr7clk;
	u32	cntr8clk;
	u32	cntr9clk;
	u32	_pad_0x48_0x5f[6];
	u32	outrst;
	u32	outrststat;
	u32	emacctl;
	u32	gpiodiv;
};

struct socfpga_clock_manager {
	/* clkmgr */
	u32	ctrl;
	u32	intr;
	u32	intrs;
	u32	intrr;
	u32	intren;
	u32	intrens;
	u32	intrenr;
	u32	stat;
	u32	testioctrl;
	u32	_pad_0x24_0x40[7];

	struct socfpga_clock_manager_main_pll main_pll;
	u32	_pad_0x6c_0xc0[5];
	struct socfpga_clock_manager_per_pll per_pll;
	u32	_pad_0x70_0x140[5];
	u32	nocclock;
};

#define CLKMGR_ALTERAGRP_MPU_CLK_OFFSET			0x140
#define CLKMGR_MAINPLL_NOC_CLK_OFFSET			0x144

/* value */
#define CLKMGR_MAINPLL_BYPASS_RESET			0x0000003f
#define CLKMGR_PERPLL_BYPASS_RESET			0x000000ff
#define CLKMGR_MAINPLL_VCO0_RESET			0x00010053
#define CLKMGR_MAINPLL_VCO1_RESET			0x00010001
#define CLKMGR_PERPLL_VCO0_RESET			0x00010053
#define CLKMGR_PERPLL_VCO1_RESET			0x00010001
#define CLKMGR_MAINPLL_VCO0_PSRC_EOSC			0x0
#define CLKMGR_MAINPLL_VCO0_PSRC_E_INTOSC		0x1
#define CLKMGR_MAINPLL_VCO0_PSRC_F2S			0x2
#define CLKMGR_PERPLL_VCO0_PSRC_EOSC			0x0
#define CLKMGR_PERPLL_VCO0_PSRC_E_INTOSC		0x1
#define CLKMGR_PERPLL_VCO0_PSRC_F2S			0x2
#define CLKMGR_PERPLL_VCO0_PSRC_MAIN			0x3

/* mask */
#define CLKMGR_MAINPLL_EN_S2FUSER0CLKEN_SET_MSK		0x00000040
#define CLKMGR_MAINPLL_EN_HMCPLLREFCLKEN_SET_MSK	0x00000080
#define CLKMGR_CLKMGR_STAT_BUSY_SET_MSK			0x00000001
#define CLKMGR_CLKMGR_STAT_MAINPLLLOCKED_SET_MSK	0x00000100
#define CLKMGR_CLKMGR_STAT_PERPLLLOCKED_SET_MSK		0x00000200
#define CLKMGR_CLKMGR_STAT_BOOTCLKSRC_SET_MSK		0x00020000
#define CLKMGR_MAINPLL_VCO0_BGPWRDN_SET_MSK		0x00000001
#define CLKMGR_MAINPLL_VCO0_PWRDN_SET_MSK		0x00000002
#define CLKMGR_MAINPLL_VCO0_EN_SET_MSK			0x00000004
#define CLKMGR_MAINPLL_VCO0_OUTRSTALL_SET_MSK		0x00000008
#define CLKMGR_MAINPLL_VCO0_REGEXTSEL_SET_MSK		0x00000010
#define CLKMGR_PERPLL_VCO0_BGPWRDN_SET_MSK		0x00000001
#define CLKMGR_PERPLL_VCO0_PWRDN_SET_MSK		0x00000002
#define CLKMGR_PERPLL_VCO0_EN_SET_MSK			0x00000004
#define CLKMGR_PERPLL_VCO0_OUTRSTALL_SET_MSK		0x00000008
#define CLKMGR_PERPLL_VCO0_REGEXTSEL_SET_MSK		0x00000010
#define CLKMGR_CLKMGR_INTR_PERPLLFBSLIP_SET_MSK		0x00000800
#define CLKMGR_CLKMGR_INTR_MAINPLLFBSLIP_SET_MSK	0x00000400
#define CLKMGR_CLKMGR_INTR_PERPLLRFSLIP_SET_MSK		0x00000200
#define CLKMGR_CLKMGR_INTR_MAINPLLRFSLIP_SET_MSK	0x00000100
#define CLKMGR_CLKMGR_INTR_PERPLLLOST_SET_MSK		0x00000008
#define CLKMGR_CLKMGR_INTR_MAINPLLLOST_SET_MSK		0x00000004
#define CLKMGR_CLKMGR_INTR_MAINPLLACHIEVED_SET_MSK	0x00000001
#define CLKMGR_CLKMGR_INTR_PERPLLACHIEVED_SET_MSK	0x00000002
#define CLKMGR_CLKMGR_CTL_BOOTMOD_SET_MSK		0x00000001
#define CLKMGR_PERPLL_EN_RESET				0x00000f7f
#define CLKMGR_PERPLLGRP_EN_SDMMCCLK_MASK		0x00000020
#define CLKMGR_MAINPLL_VCO0_PSRC_MSK			0x00000003
#define CLKMGR_MAINPLL_VCO1_NUMER_MSK			0x00001fff
#define CLKMGR_MAINPLL_VCO1_DENOM_MSK			0x0000003f
#define CLKMGR_MAINPLL_CNTRCLK_MSK			0x000003ff
#define CLKMGR_PERPLL_VCO0_PSRC_MSK			0x00000003
#define CLKMGR_PERPLL_VCO1_NUMER_MSK			0x00001fff
#define CLKMGR_PERPLL_VCO1_DENOM_MSK			0x0000003f
#define CLKMGR_PERPLL_CNTRCLK_MSK			0x000003ff
#define CLKMGR_MAINPLL_NOCDIV_MSK			0x00000003
#define CLKMGR_MAINPLL_NOCCLK_CNT_MSK			0x000003ff
#define CLKMGR_MAINPLL_NOCCLK_SRC_MSK			0x00000007
#define CLKMGR_MAINPLL_NOCCLK_SRC_MAIN		0
#define CLKMGR_MAINPLL_NOCCLK_SRC_PERI		1
#define CLKMGR_MAINPLL_NOCCLK_SRC_OSC1		2
#define CLKMGR_MAINPLL_NOCCLK_SRC_INTOSC	3
#define CLKMGR_MAINPLL_NOCCLK_SRC_FPGA		4

#define CLKMGR_PERPLLGRP_SRC_MSK			0x00000007
#define CLKMGR_PERPLLGRP_SRC_MAIN	0
#define CLKMGR_PERPLLGRP_SRC_PERI	1
#define CLKMGR_PERPLLGRP_SRC_OSC1	2
#define CLKMGR_PERPLLGRP_SRC_INTOSC	3
#define CLKMGR_PERPLLGRP_SRC_FPGA	4

/* bit shifting macro */
#define CLKMGR_MAINPLL_VCO0_PSRC_LSB		8
#define CLKMGR_PERPLL_VCO0_PSRC_LSB		8
#define CLKMGR_MAINPLL_VCO1_DENOM_LSB		16
#define CLKMGR_PERPLL_VCO1_DENOM_LSB		16
#define CLKMGR_MAINPLL_NOCCLK_PERICNT_LSB		16
#define CLKMGR_MAINPLL_NOCCLK_SRC_LSB		16
#define CLKMGR_MAINPLL_NOCDIV_L4MAINCLK_LSB	0
#define CLKMGR_MAINPLL_NOCDIV_L4MPCLK_LSB	8
#define CLKMGR_MAINPLL_NOCDIV_L4SPCLK_LSB	16
#define CLKMGR_MAINPLL_NOCDIV_CSATCLK_LSB	24
#define CLKMGR_MAINPLL_NOCDIV_CSTRACECLK_LSB	26
#define CLKMGR_MAINPLL_NOCDIV_CSPDBGCLK_LSB	28
#define CLKMGR_MAINPLL_MPUCLK_SRC_LSB		16
#define CLKMGR_MAINPLL_NOCCLK_SRC_LSB		16
#define CLKMGR_MAINPLL_CNTR7CLK_SRC_LSB		16
#define CLKMGR_MAINPLL_CNTR9CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR2CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR3CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR4CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR5CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR6CLK_SRC_LSB		16
#define CLKMGR_PERPLL_CNTR8CLK_SRC_LSB		16
#define CLKMGR_PERPLL_EMACCTL_EMAC0SEL_LSB	26
#define CLKMGR_PERPLL_EMACCTL_EMAC1SEL_LSB	27
#define CLKMGR_PERPLL_EMACCTL_EMAC2SEL_LSB	28

#endif /* _SOCFPGA_CLOCK_MANAGER_H_ */
